(function(a,f){typeof exports=="object"&&typeof module!="undefined"?module.exports=f(require("vue")):typeof define=="function"&&define.amd?define(["vue"],f):(a=typeof globalThis!="undefined"?globalThis:a||self,a.Vue3Tinymce=f(a.Vue))})(this,function(a){"use strict";const f=t=>t+"_"+(Date.now()+Math.floor(Math.random()*1e6)),h=()=>{const t=typeof window!="undefined"?window:global;return t&&"tinymce"in t?t.tinymce:null};function C(t){return t?t.getContent():""}function b(t,r){!r||r.setContent(t)}function T(t,r){if(!!r){if(r.resetContent)return r.resetContent(t);r.setContent(t),r.setDirty(!1),r.undoManager.clear()}}function E(t,r=!0){!t||t.mode.set(r?"readonly":"design")}function D(t,r,c){return new Promise((d,o)=>{let{images_upload_url:n,images_upload_credentials:l,custom_images_upload_header:u,custom_images_upload_param:m,custom_images_upload_callback:_}=t||{},s,p;s=new XMLHttpRequest,s.withCredentials=!!l,s.open("POST",n||""),u&&Object.keys(u).forEach(e=>{s.setRequestHeader(e,u[e])}),s.upload.onprogress=function(e){c(e.loaded/e.total*100)},s.onload=function(){if(s.status===403){o({message:"HTTP Error: "+s.status,remove:!0});return}if(s.status<200||s.status>=300){o("HTTP Error: "+s.status);return}let e=JSON.parse(s.responseText);if(!e){o("Invalid JSON: "+s.responseText);return}let i=typeof _=="function"?_(e):e.location;if(!i){o("Failed Path: location image path is error/empty");return}d(i)},s.onerror=function(){o("Image upload failed due to a XHR Transport error. Code: "+s.status)},p=new FormData,p.append("file",r.blob(),r.filename()),m&&Object.keys(m).forEach(e=>{p.append(e,m[e])}),s.send(p)})}const k=(()=>{let t={status:{},loadedCallbacks:{}};const r=(o,n)=>{const l=document.createElement("script");l.id=f("tiny-script"),l.type="application/javascript",l.src=o,l.referrerPolicy="origin";const u=()=>{l.removeEventListener("load",u),n()};l.addEventListener("load",u),(document.head||document.body).appendChild(l)},c=o=>{!t.loadedCallbacks[o]||(t.loadedCallbacks[o].forEach(n=>{typeof n.handler=="function"&&n.handler.call(n.scope)}),t.loadedCallbacks[o]=void 0)};return{load:(o,n,l)=>{if(n&&(t.loadedCallbacks[o]||(t.loadedCallbacks[o]=[]),t.loadedCallbacks[o].push({handler:n,scope:l||globalThis})),t.status[o]==="LOADED"){c(o);return}t.status[o]!=="LOADING"&&(t.status[o]="LOADING",r(o,()=>{t.status[o]="LOADED",c(o)}))}}})(),w=["id"],V={key:0},y=Object.assign({name:"Vue3Tinymce"},{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup(t,{expose:r,emit:c}){const d=t;let o=!0;const n=a.reactive({editor:null,id:f("tinymce"),err:""}),l=()=>{var e;return String((e=d.modelValue)!=null?e:"")},u=e=>c("update:modelValue",e),m=(e,i,g)=>{!d.debug||console.log(`\u6765\u81EA\uFF1A${e.type} | 
 ${i} 
 ${g||"--"}`)},_=(e,i)=>{i||(i=n.editor);const g=C(i);m(e,g),u(g),c("change",g)},s=e=>{n.editor=e,b(l(),e),d.disabled&&e.mode.get()!=="readonly"&&E(e),e.on("change input undo redo",i=>{_(i,e)}),c("init",e)},p=()=>{if(h()===null){n.err="tinymce is null";return}d.debug&&console.warn("vue3-tinymce \u8FDB\u5165debug\u6A21\u5F0F");let e={...d.setting,selector:"#"+n.id,setup:i=>{d.setup&&d.setup(i),i.on("init",()=>s(i))}};d.setting.custom_images_upload&&(e.images_upload_handler=(...i)=>D.apply(null,[d.setting,...i])),h().init(e),o=!1};return a.watch(()=>d.modelValue,(e,i)=>{if(!(!n.editor||!n.editor.initialized)&&!(i===e||e===C(n.editor))){if(m({type:"propsChanged to setContent"},e,i),e===null)return T("",n.editor);b(l(),n.editor)}}),a.watch(()=>d.disabled,e=>{!n.editor||!n.editor.initialized||E(n.editor,e)}),r({id:n.id,editor:n.editor}),a.onMounted(()=>{var i;if(h()!==null){p();return}const e=(i=d.scriptSrc)!=null?i:"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js";k.load(e,p)}),a.onActivated(()=>{o||p()}),a.onDeactivated(()=>{!n.editor||n.editor.remove()}),a.onBeforeUnmount(()=>{!n.editor||n.editor.remove()}),(e,i)=>(a.openBlock(),a.createElementBlock(a.Fragment,null,[a.createElementVNode("div",{id:n.id,class:"tiny-textarea"},null,8,w),n.err?(a.openBlock(),a.createElementBlock("p",V,a.toDisplayString(n.err),1)):a.createCommentVNode("",!0)],64))}});return y.install=function(t){t.component("Vue3Tinymce",y)},y});
